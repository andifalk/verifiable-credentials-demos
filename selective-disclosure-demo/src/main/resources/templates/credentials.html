<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <meta charset="UTF-8"/>
    <title>Selective Disclosure Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>
</head>
<body>
<div th:replace="~{fragments :: header}"></div>

<div class="container-fluid">
    <h1>Verifiable Credentials</h1>

    <div class="accordion" id="verifiableCredentials">

        <div th:if="${undisclosedFields != null}">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        Undisclosed Claims
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#verifiableCredentials">
                    <div class="accordion-body">
                        <ul th:each="undisclosed : ${undisclosedFields}">
                            <li th:text="${undisclosed.getKey()} + ': ' + ${undisclosed.getValue()}"></li>
                        </ul>
                    </div>
                </div>
            </div>

            <hr>

            <div th:if="${disclosedFields != null}">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            Disclosed Claims
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse"
                         data-bs-parent="#verifiableCredentials">
                        <div class="accordion-body">
                            <table class="table table-striped">
                                <tr>
                                    <th>Salt</th>
                                    <th>Claim</th>
                                    <th>Claim Value</th>
                                    <th>Digest = SHA-256(Disclosure)</th>
                                    <th>Disclosure = Base64Url([salt,claim,value])</th>
                                </tr>
                                <tr th:each="disclosed : ${disclosedFields}">
                                    <td th:text="${disclosed.getSalt()}"></td>
                                    <td th:text="${disclosed.getClaimName()}"></td>
                                    <td th:text="${disclosed.getClaimValue()}"></td>
                                    <td style="color: #c53030" th:text="${disclosed.digest()}"></td>
                                    <td>
                                        <span style="color: green;" th:text="${disclosed}"></span>
                                        <p><span th:text="' Decoded:' + ${@selectiveDisclosureService.base64Decode(disclosed.toString())}"></span></p>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <div th:if="${credentialJwt != null}">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                            CredentialJWT
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse"
                         data-bs-parent="#verifiableCredentials">
                        <div class="accordion-body">
                            <h3>Header</h3>
                            <p><span style="white-space: break-spaces; line-break: normal"
                                     th:text="${credentialJwt.getHeader().toJSONObject()}">credential</span></p>
                            <h3>Payload</h3>
                            <p><span style="white-space: collapse; line-break: normal; color: #c53030" class="text-wrap text-break"
                                     th:text="${credentialJwt.getJWTClaimsSet().toJSONObject()}">credential</span></p>
                            <h3>Disclosures</h3>
                            <ul th:each="disclosed : ${disclosedFields}">
                                <li style="color: green" th:text="${disclosed}"></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <hr>

                <div th:if="${sdJwt != null}">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                SD-JWT
                            </button>
                        </h2>
                        <div id="collapseFour" class="accordion-collapse collapse"
                             data-bs-parent="#verifiableCredentials">
                            <div class="accordion-body">
                                <h3>Credential JWT</h3>
                                <p><span style="white-space: wrap; line-break: anywhere"
                                         th:text="${sdJwt.getCredentialJwt()}">credential</span></p>
                                <h3>Disclosures</h3>
                                <p><span style="white-space: wrap; line-break: anywhere; color: green"
                                         th:text="${sdJwtDisclosures}">credential</span>
                                </p>
                                <h3>SD JWT</h3>
                                <p><span style="white-space: wrap; line-break: anywhere"
                                         th:text="${sdJwt.toString()}">credential</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
